---
import Layout from "../layouts/Layout.astro";
---

<Layout title="SharePeer">
    <html>
        <head>
            <title>Firebase Auth Example</title>
        </head>
        <body>
            <form id="login-form">
                <input type="email" id="email" placeholder="Email" required />
                <input
                    type="password"
                    id="password"
                    placeholder="Password"
                    required
                />
                <button type="submit">Login</button>
            </form>

            <script type="module">
                // Import the functions you need from the SDKs you need
                import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
                import {
                    getAuth,
                    signInWithEmailAndPassword,
                } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

                const firebaseConfig = {
                    apiKey: "AIzaSyDWI3sIVqRWvLE56b4YM5CK7lEEIMfdJaA",
                    authDomain: "share-peer.firebaseapp.com",
                    projectId: "share-peer",
                    storageBucket: "share-peer.appspot.com",
                    messagingSenderId: "222803683103",
                    appId: "1:222803683103:web:93230e62dcdc2677ad722a",
                    measurementId: "G-6M7JXCVYR2",
                };

                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);

                document
                    .getElementById("login-form")
                    .addEventListener("submit", async (e) => {
                        e.preventDefault();
                        const email = document.getElementById("email").value;
                        const password =
                            document.getElementById("password").value;

                        try {
                            const userCredential =
                                await signInWithEmailAndPassword(
                                    auth,
                                    email,
                                    password
                                );
                            const idToken =
                                await userCredential.user.getIdToken();
                            console.log(idToken);
                            const response = await fetch(
                                "https://share-peer-server-prod.vercel.app/login",
                                {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json",
                                        Authorization: `Bearer ${idToken}`,
                                    },
                                    credentials: "include",
                                    body: JSON.stringify({ email }),
                                }
                            );

                            const data = await response.json();
                            console.log(data);
                            if (data.message === "Login successful"){
                                window.localStorage.setItem("TOKEN", data.token)
                            }
                        } catch (error) {
                            console.error("Error logging in:", error);
                        }
                    });
            </script>
        </body>
    </html>
</Layout>
